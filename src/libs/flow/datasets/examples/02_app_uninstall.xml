<workflow id="workflow-7a73c5a1">
  <description></description>
  <startEvent id="workflow-81607ee7"></startEvent>
  <exclusiveCondition id="ask_user_permission" name="Ask user permission">
    <condition id="ask-user-permission-6ae69120" input="global.ask-user-permission-6de11b7b" name="Yes" targetRef="request_permission_to_remove_application" operator="eq" value="Yes"></condition>
    <condition id="ask-user-permission-0aeae2d0" input="global.ask-user-permission-6de11b7b" name="No" targetRef="uninstall_application" operator="eq" value="No"></condition>
  </exclusiveCondition>
  <exclusiveCondition id="check_application_removal_request_response" name="Check application removal request response" description="">
    <condition id="check-application-removal-request-response-bcd10dd4" input="request_permission_to_remove_application.result.outputs.application_in_use" name="App still required" targetRef="log_ticket_application_is_in_use" operator="eq" value="yes_i_need_it"></condition>
    <condition id="check-application-removal-request-response-555d2683" input="request_permission_to_remove_application.result.outputs.uninstall_invoke" name="Permission granted" targetRef="uninstall_application" operator="eq" value="uninstall_now"></condition>
    <condition id="check-application-removal-request-response-dbdf0b9f" input="request_permission_to_remove_application.result.outputs.uninstall_invoke" name="Refused removal" targetRef="log_ticket_application_is_in_use" operator="eq" value="not_right_now"></condition>
  </exclusiveCondition>
  <exclusiveCondition id="check_uninstall_application_ra_status" name="Check uninstall application RA status">
    <condition id="check-uninstall-application-ra-status-5ffba9bc" input="uninstall_application.result.status" name="Success" targetRef="confirm_application_removal" operator="eq" value="Success"></condition>
    <condition id="check-uninstall-application-ra-status-37afb171" input="uninstall_application.result.status" name="Failure" targetRef="log_ticket_application_uninstallation_failed" operator="neq" value="Success"></condition>
  </exclusiveCondition>
  <thinklet id="request_permission_to_remove_application" name="Request permission to remove application" type="engage" timeout="5">
    <campaignId>application_removal_request</campaignId>
  </thinklet>
  <thinklet id="uninstall_application" name="Uninstall application" type="act" timeout="5">
    <remoteActionId>uninstall_application_windows</remoteActionId>
    <parameter name="ApplicationName" source="global.application_to_be_removed"></parameter>
    <parameter name="UninstallParameters" value="\quiet"></parameter>
  </thinklet>
  <thinklet id="confirm_application_removal" name="Confirm application removal" type="engage" timeout="5">
    <campaignId>application_successfully_removed</campaignId>
  </thinklet>
  <thinklet id="log_ticket_application_uninstallation_failed" name="Log ticket - application uninstallation failed" type="sapi">
    <credentialsId>conn_cr-30</credentialsId>
    <httpMethod>POST</httpMethod>
    <resourcePath>api/now/table/incident</resourcePath>
    <payloadTemplate>{
  &quot;assignment_group&quot;: &quot;ConfigMgr&quot;,
  &quot;business_service&quot;: &quot;ConfigMgr&quot;,
  &quot;caller_id&quot;: &quot;NexthinkFlow&quot;,
  &quot;description&quot;: &quot;Putty application still in use on this device&quot;,
  &quot;impact&quot;: &quot;1&quot;,
  &quot;short_description&quot;: &quot;Incident created by NexthinkFlow&quot;,
  &quot;urgency&quot;: 3,
  &quot;cmdb_ci&quot;: &quot;{{nx.device.name}}&quot;
}</payloadTemplate>
  </thinklet>
  <thinklet id="log_ticket_application_is_in_use" name="Log ticket - application is in use" type="sapi">
    <credentialsId>conn_cr-30</credentialsId>
    <httpMethod>POST</httpMethod>
    <resourcePath>api/now/table/incident</resourcePath>
    <payloadTemplate>{
  &quot;assignment_group&quot;: &quot;ConfigMgr&quot;,
  &quot;business_service&quot;: &quot;ConfigMgr&quot;,
  &quot;caller_id&quot;: &quot;NexthinkFlow&quot;,
  &quot;description&quot;: &quot;Putty application still in use on this device, or user declined to remove the application&quot;,
  &quot;impact&quot;: &quot;1&quot;,
  &quot;short_description&quot;: &quot;Incident created by NexthinkFlow&quot;,
  &quot;urgency&quot;: 3,
  &quot;cmdb_ci&quot;: &quot;{{nx.device.name}}&quot;
}</payloadTemplate>
  </thinklet>
  <endEvent id="end-b2526738">
    <outcome>NO_ACTION_TAKEN</outcome>
    <outcomeDetails>User refused application removal</outcomeDetails>
  </endEvent>
  <endEvent id="end-0faaaff1">
    <outcome>FAILED</outcome>
    <outcomeDetails>&quot;Uninstall application&quot; remote action failed</outcomeDetails>
  </endEvent>
  <endEvent id="end-e90fa8a7">
    <outcome>ACTION_TAKEN</outcome>
    <outcomeDetails>Application uninstalled</outcomeDetails>
  </endEvent>
  <globalVariable id="ask-user-permission-6de11b7b" name="Ask user permission?" customValue="false" type="string">
    <value>Yes</value>
    <value>No</value>
  </globalVariable>
  <globalVariable id="application_to_be_removed" name="Application to be removed" customValue="false" type="string">
    <value>PuTTY release 0.79 (64-bit)</value>
  </globalVariable>
  <path id="path-e2fb86d8" sourceRef="workflow-81607ee7" targetRef="ask_user_permission"></path>
  <path id="path-39c09f1c" sourceRef="request_permission_to_remove_application" targetRef="check_application_removal_request_response"></path>
  <path id="path-0f4cbbc4" sourceRef="uninstall_application" targetRef="check_uninstall_application_ra_status"></path>
  <path id="path-2e3a190f" sourceRef="log_ticket_application_is_in_use" targetRef="end-b2526738"></path>
  <path id="path-5534284b" sourceRef="log_ticket_application_uninstallation_failed" targetRef="end-0faaaff1"></path>
  <path id="path-9cb48ff7" sourceRef="confirm_application_removal" targetRef="end-e90fa8a7"></path>
</workflow>